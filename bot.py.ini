from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes
import os
import random
import logging

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)

# –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
TOKEN = "7962193493:AAFzDeKndwyfjv6EKEegGJlO7dLqdy4br34"

# –ü—É—Ç–∏ –∫ –ø–∞–ø–∫–∞–º —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
IMAGES_FOLDER_WILD_ANIMALS = "./Images/Animals/Wild"
IMAGES_FOLDER_DOMESTIC_ANIMALS = "./Images/Animals/domestic"
IMAGES_FOLDER_FOOD_PLANTS = "./Images/Nature/Foodplants"
IMAGES_FOLDER_MEDICINAL_PLANTS = "./Images/Nature/Medicinalplants"
IMAGES_FOLDER_DECORATIVE_PLANTS = "./Images/Nature/Ornamentalplants"
IMAGES_FOLDER_LESSONS = "./Images/Lessons"
AUDIO_FOLDER = "./Images/Audio"


# –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫–≤–∏–∑–∞: –∫–∞—Ä—Ç–∏–Ω–∫–∞ -> –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
quiz_data_wild_animals = {
    "image1.jpg": "–ú—É–ª–∫–∞—á",
    "image2.jpg": "–ö–∞—à–∫”ë—Ä",
    "image3.jpg": "–£–ø–∞",
    "image4.jpg": "–¢–∏–ª”ó",
    "image5.jpg": "–ü–∞–ª–∞–Ω",
    "image6.jpg": "–ü—É—Ä”ë—à",
    "image7.jpg": "–•–∏—Ä –∫—É—à–∞–∫ƒï",
    "image8.jpg": "–•ƒÉ–Ω—ÇƒÉ—Ä",
    "image9.jpg": "–•–∏—Ä —Å—ã—Å–Ω–∏",
    "image10.jpg": "–Æ—Å",
    "image11.jpg": "–®—É—Ä”ë —É–ø–∞",
    "image12.jpg": "–í”ë–ª—Ç–∞ —Ç”ë–ø—Ä–∏",
    "image13.jpg": "–®–∞—à–∫–∞",
    "image14.jpg": "–ß–∞–ªƒÉ—à —Å—É—Ö–∞",
    "image15.jpg": "–•–∏—Ä –∫—É—à–∞–∫ƒï",
}

quiz_data_domestic_animals = {
    "image1.jpg": "–ô—ã—Ç”ë",
    "image2.jpg": "–ö—É—à–∞–∫",
    "image3.jpg": "”ñ–Ω–µ",
    "image4.jpg": "–õ–∞—à–∞",
    "image5.jpg": "–ö–∞—á–∞–∫–∞",
    "image6.jpg": "–°—É—Ä”ë—Ö",
    "image7.jpg": "–°—ã—Å–Ω–∞",
    "image8.jpg": "–ö—Ä–æ–ª–∏–∫",
    "image9.jpg": "–ß”ë—Ö",
    "image10.jpg": "–ö”ë–≤–∞–∫–∞–ª",
    "image11.jpg": "–•—É—Ä",
    "image12.jpg": "–öƒÉ—Ä–∫–∫–∞",
    "image13.jpg": "–ê—Ä–ª–∞–Ω",
    "image14.jpg": "–ü–æ–ø—É–≥–∞–π",
    "image15.jpg": "–¢–∏–Ω”ó—Å —Å—ã—Å–Ω–∏",
}

quiz_data_medicinal_plants = {
    "image1.jpg": "–•—É—Ä”ë–Ω",
    "image2.jpg": "–ö–∞—Ç”ë—Ä–∫–∞—Å",
    "image3.jpg": "–ö”ó—Ç–º–µ–ª",
    "image4.jpg": "–í”ó–ª—Ç—Ä–µ–Ω",
    "image5.jpg": "–ö—É–∫—à–∞–ø—É“´",
}

quiz_data_food_plants = {
    "image1.jpg": "“™”ó—Ä—É–ª–º–∏",
    "image2.jpg": "–•”ó—Ä–ª”ó —Ö—É—Ä–ª”ë—Ö–∞–Ω",
    "image3.jpg": "–•—É—Ä–∞ “´—ã—Ä–ª–∞",
    "image4.jpg": "–•—É—Ä–∞ —Ö—É—Ä–ª”ë—Ö–∞–Ω",
    "image5.jpg": "–£–ª–º—É“´“´–∏",
}

quiz_data_decorative_plants = {
    "image1.jpg": "–ö–∞–∫—Ç—É—Å",
    "image2.jpg": "–ê–∫–∞—Ü–∏",
    "image3.jpg": "–¢—é–ª—å–ø–∞–Ω",
    "image4.jpg": "–ù–∞—Ä—Ü–∏—Å—Å",
    "image5.jpg": "–ê–ª–æ—ç",
    "image6.jpg": "–ë–µ–≥–æ–Ω–∏",
}

# –°–ø–∏—Å–æ–∫ —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–ª–æ–≤ –¥–ª—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
random_words = [
    "–®–∫—É–ª", "–ö–∞–π”ë–∫", "–ô—ã–≤”ë“´", "–ö”ó–ª–µ–Ω—á–µ", "–ß”≥—Ä–µ—á–µ", "–´–ª—Ç”ë–Ω", "–ê–ª”ë–∫", "–¢—É—Ä–∞—Ç", "–ü–∞—Ç–∞–∫", "–ü—É–∫–∞–Ω", "–°”ó—Ç–µ–ª", "–°–∞–≤”ë—Ç-—Å–∞–ø–∞", "–ö”ó–Ω–µ–∫–µ", "–ö”ë—Ä–∞–Ω—Ç–∞—à", "–®”ë–ø—á”ë–∫", "–°—ã–≤–ª”ë—à", "–®”ë—Ä—á”ë–∫", "“™–∞–Ω—Ç–∞–ª”ë–∫", "“™—É–ª—Ç–∞–ª”ë–∫", "–ü”≥—Ä–Ω–µ",
    "–ú”ë–π”ë—Ä", "–ß”ó—Ä–µ", "–•”ó–≤–µ–ª", "–£–π”ë—Ö", "“™”ë–ª—Ç”ë—Ä", "–Æ—Ä", "“™—É–Ω–∞—à–∫–∞", "–ô”ó–ª—Ç”ó—Ä", "–ü—É“´", "–•”ë—è—Ä", "–®”ë–Ω–∞", "–Ø—à–∫–∞", "–®—ã–≤", "–í—É—Ç”ë", "”≤–∫–µ—Ä—á”ó–∫", "–•—É–ª–∞"
]
LESSON_TOPICS = {
    1: "–°–∞–ª–∞–º",
    2: "–°—ã–≤–ª”ë—Ö —Å—É–Ω–∞—Ç”ë–ø",
    3: "–ö—É –∫–∞–º?",
    4: "–ö—É –º”ó–Ω?",
    5: "–ö–ª–∞—Å—Ä–∞",
    6: "–ü–∏—Ä”ó–Ω –ø”ó—á”ó–∫ —Ç—É—Å—Å–µ–º",
    7: "–í—ã–ª—å”ë—Ö-—á”ó—Ä–ª”ó—Ö",
    8: "–ö–∏–ª—Ç–∏ –∫–∞–π”ë–∫-–∫”ó—à”ó–∫",
    9: "√á–∞–º—Ä”ë–∫ —á”ó—Ä —á—É–Ω—Å–µ–º",
    10: "–ú”ó–Ω –ø—É—Ä?",
    11: "–ê—Ç—å”ë—Ä –≤—ã–ª—è—Ç–ø”ë—Ä! –ö—É –º”ó–Ω?", 
    12: "–≠–ø”ó –º”ó–Ω —Ç”ë–≤–∞—Ç”ë–ø?",
    13: "–≠—Å”ó –º”ó–Ω —Ç”ë–≤–∞—Ç”ë–Ω?",
    14: "–í”ë–ª –º”ó–Ω —Ç”ë–≤–∞—Ç—å?",
    15: "–ú–∏√ß–µ?",
    16: "–ú–∏√ß–µ? –¢–µ√ß–µ—Ç–∫–µ—Å–µ–º",
    17: "–ú”ó–Ω —Ç”ó—Å–ª”ó?",
    18: "–ü”ó—Ç”ó–º–ª–µ—Ç”≥",
    19: "–≠—Ç–Ω–µ—Ä –∫–∏–ª-–π—ã—à”ó",
    20: "–ú–∞–Ω”ë–Ω –∫–∏–ª-–π—ã—à",
    21: "–≠—Å”ó –º–∏√ß–µ √ß—É–ª—Ç–∞?",
    22: "–ú–∞–Ω”ë–Ω –ø”≥–ª”ó–º",
    23: "–ú”ó–Ω–ª–µ?",
    24: "–¢”ó–ø–µ–ª—Ç–µ",
    25: "–ü–∏—Ç”ó —Ç—É—Ç–ª”ë!",
    26: "–°”ó—Ç-—Ç—É—Ä”ë—Ö",
    27: "–£–ª–º–∞-√ß—ã—Ä–ª–∞",
    28: "–ü–∞—Ö—á–∞ “´–∏–º”ó“´",
    29: "√á—É—Ä–∞–ª–Ω”ë –∫—É–Ω",
    30: "–ü–∞—Ä–Ω–µ—Å–µ–º",
    31: "√á”ó–Ω”ó √ß—É–ª —è—á”ó–ø–µ!",
    32: "–ê—Ç—å”ë—Ä –≤—ã–ª—è—Ç–ø”ë—Ä!",
    33: "–•”ó–ª–ª–µ—Ö–∏ √ß–∞–Ω—Ç–∞–ª”ë–∫",
    34: "–•”ó–ª–ª–µ –º”ó–Ω–ª–µ –ª–∞–π”ë—Ö!",
    35: "–•”ó–ª–ª–µ—Ö–∏ —Ç—É–º—Ç–∏—Ä",
    36: "–ò—Ä—Ö–∏–Ω–µ",
    37: "“™”ë–≤”ë–Ω–º–∞–ª–ª–∏ –ø”≥–ª”ó–º",
    38: "–ö”ë–Ω—Ç”ë—Ä–ª–∞ —à–∫—É–ª—Ç–∞",
    39: "–í”ó—Ä–µ–Ω–µ–≤—Ä–µ",
    40: "–ü—É—à”ë –≤”ë—Ö”ë—Ç—Ä–∞",
    41: "–®”ë–º–∞—Ç –∫—É–Ω –∫–∞√ß—Ö–∏–Ω–µ",
    42: "–ö—É–Ω –π”ó—Ä–∫–∏",
    43: "√á—É—Ä—Ö–∏ √ß–∞–Ω—Ç–∞–ª”ë–∫",
    44: "–ö–∞–π”ë–∫—Å–µ–º",
    45: "–ü–∞—Ä–∫—Ä–∞",
    46: "–í”ë—Ä–º–∞–Ω—Ç–∞",
    47: "–ü”ó—Ä—Ä–µ–º”ó—à —á–µ—á–µ–∫—Å–µ–º",
    48: "“™–µ—Ä–µ–º “´–∏–Ω—á–µ",
    49: "√á—É—Ä–∫—É–Ω–Ω–µ",
    50: "–ê—Ç—å”ë—Ä –≤—ã–ª—è—Ç–ø”ë—Ä!",
    51: "–ö–∞–Ω–∏–∫—É–ª—Ç–∞",
    52: "–Ø–ª—Ç–∞",
    53: "–•—É–ª–∞—Ä–∞",
    54: "–ö”≥–ª–º–µ–∫",
    55: "–ê—á–∞-–ø”ë—á–∞ –ª–∞–ø—Ç”ë–∫”ó",
    56: "–°–ø–æ—Ä—Ç —Ü–µ–Ω—Ç—Ä”ó",
    57: "√á—É–ª—Ç–∞–ª”ë–∫ –≤”ë—Ö”ë—á”ó—Å–µ–º",
    58: "–ß–∞—Å–∞—Ö “´—É–ª–ª–∞",
    59: "√á—ã—Ä–ª–∞—Ä–∞",
    60: "“™—É–ª “´”≥—Ä–µ–≤",
    61: "–®—ã–≤ —Ö”ó—Ä—Ä–∏–Ω—á–µ",
    62: "–ß”ó—Ä —á—É–Ω –ø–∞—Ä–∫”ó",
    63: "–®—É–ø–∞—à–∫–∞—Ä",
    64: "“™—É–ª–ª–∞—Ö–∏ –≤”ë—Ä–º–∞–Ω—Ç–∞",
    65: "√á—É—Ç √ß–∞–Ω—Ç–∞–ª”ë–∫",
    66: "–ê—Ç—å”ë—Ä –≤—ã–ª—è—Ç–ø”ë—Ä!",
    67: "–ü—É—Å—Ç–æ",
    68: "–ü—É—Å—Ç–æ",
    69: "–ü—É—Å—Ç–æ",
    70: "–ü—É—Å—Ç–æ",

}

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ª–æ–≤
def create_word_keyboard(correct_answer):
    # –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ quiz_data (–∏—Å–∫–ª—é—á–∞—è —Ç–µ–∫—É—â–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
    all_quiz_answers = [v for k, v in quiz_data_wild_animals.items() if v != correct_answer] + \
                       [v for k, v in quiz_data_domestic_animals.items() if v != correct_answer] + \
                       [v for k, v in quiz_data_food_plants.items() if v != correct_answer] + \
                       [v for k, v in quiz_data_medicinal_plants.items() if v != correct_answer] + \
                       [v for k, v in quiz_data_decorative_plants.items() if v != correct_answer]
    
    # –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–ª–æ–≤
    all_random_words = random_words.copy()
    
    # –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ–±–∞ —Å–ø–∏—Å–∫–∞
    all_possible_wrong_answers = all_quiz_answers + all_random_words
    
    # –í—ã–±–∏—Ä–∞–µ–º 3 —Å–ª—É—á–∞–π–Ω—ã—Ö –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞
    wrong_answers = random.sample(all_possible_wrong_answers, 3)
    
    # –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–∑ 4 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: 1 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ 3 –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö
    options = [correct_answer] + wrong_answers
    random.shuffle(options)  # –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã

    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    keyboard = [[InlineKeyboardButton(word, callback_data=word)] for word in options]
    return InlineKeyboardMarkup(keyboard)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É –∫–≤–∏–∑–∞–º–∏ –∏ —É—Ä–æ–∫–∞–º–∏
    keyboard = [
        [InlineKeyboardButton("–ö–≤–∏–∑—ã", callback_data="quizzes")],
        [InlineKeyboardButton("–£—Ä–æ–∫–∏", callback_data="lessons")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text("–ü—Ä–∏–≤–µ—Ç! –í—ã–±–µ—Ä–∏, —á—Ç–æ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å:", reply_markup=reply_markup)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É –∫–≤–∏–∑–∞–º–∏ –∏ —É—Ä–æ–∫–∞–º–∏
async def handle_menu_choice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == "quizzes":
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–¥–µ–ª–∞ –∫–≤–∏–∑–∞
        keyboard = [
            [InlineKeyboardButton("–ñ–∏–≤–æ—Ç–Ω—ã–µ", callback_data="quiz_animals")],
            [InlineKeyboardButton("–ü—Ä–∏—Ä–æ–¥–∞", callback_data="quiz_plants")],
            [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="back_to_start")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª –∫–≤–∏–∑–∞:", reply_markup=reply_markup)
    elif query.data == "lessons":
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø—ã —É—Ä–æ–∫–æ–≤
        keyboard = [
        [InlineKeyboardButton("1-10 –£—Ä–æ–∫–∏", callback_data="lessons_1_10")],
        [InlineKeyboardButton("11-20 –£—Ä–æ–∫–∏", callback_data="lessons_11_20")],
        [InlineKeyboardButton("21-30 –£—Ä–æ–∫–∏", callback_data="lessons_21_30")],
        [InlineKeyboardButton("31-40 –£—Ä–æ–∫–∏", callback_data="lessons_31_40")],
        [InlineKeyboardButton("41-50 –£—Ä–æ–∫–∏", callback_data="lessons_41_50")],
        [InlineKeyboardButton("51-60 –£—Ä–æ–∫–∏", callback_data="lessons_51_60")],
        [InlineKeyboardButton("61-70 –£—Ä–æ–∫–∏", callback_data="lessons_61_70")],
        [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="back_to_start")] 
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text("–í—ã–±–µ—Ä–∏ –≥—Ä—É–ø–ø—É —É—Ä–æ–∫–æ–≤:", reply_markup=reply_markup)



# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø—ã —É—Ä–æ–∫–æ–≤
async def handle_lessons_group(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    group_data = query.data.split("_")
    start = int(group_data[1])
    end = int(group_data[2])
    
    keyboard = []
    # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
    for lesson_num in range(start, end + 1):
        topic = LESSON_TOPICS.get(lesson_num, "–ù–æ–≤–∞—è —Ç–µ–º–∞")
        button_text = f"–£—Ä–æ–∫ {lesson_num} - {topic}"
        # –£–∫–æ—Ä–∞—á–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π
        if len(button_text) > 30:
            button_text = f"–£—Ä–æ–∫ {lesson_num} - {topic[:20]}..."
        keyboard.append([InlineKeyboardButton(button_text, callback_data=f"lesson_{lesson_num}")])
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
    keyboard.append([InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="lessons")])
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.edit_message_text(
        f"–í—ã–±–µ—Ä–∏ —É—Ä–æ–∫ –∏–∑ –≥—Ä—É–ø–ø—ã {start}-{end}:",
        reply_markup=reply_markup
    )


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—Ä–æ–∫–∞
async def handle_lesson(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    lesson_num = query.data.split("_")[1]
    images_paths = []
    audio_path = None

    logger.debug(f"–ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è —É—Ä–æ–∫–∞ {lesson_num}")

    try:
        try:
            lesson_topic = LESSON_TOPICS[int(lesson_num)]
            logger.debug(f"–¢–µ–º–∞ —É—Ä–æ–∫–∞ {lesson_num}: {lesson_topic}")
        except KeyError:
            lesson_topic = f"–£—Ä–æ–∫ {lesson_num}"
            logger.error(f"–¢–µ–º–∞ –¥–ª—è —É—Ä–æ–∫–∞ {lesson_num} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ LESSON_TOPICS")

        if not os.path.exists(IMAGES_FOLDER_LESSONS):
            logger.error(f"–ü–∞–ø–∫–∞ —Å —É—Ä–æ–∫–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {IMAGES_FOLDER_LESSONS}")
            await query.message.reply_text("–ò–∑–≤–∏–Ω–∏—Ç–µ, —É—Ä–æ–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã üöß")
            return

        images_paths = [
            os.path.join(IMAGES_FOLDER_LESSONS, f"lesson{lesson_num}_1.jpg"),
            os.path.join(IMAGES_FOLDER_LESSONS, f"lesson{lesson_num}_2.jpg")
        ]

        for image_path in images_paths:
            if os.path.exists(image_path):
                with open(image_path, "rb") as image:
                    await context.bot.send_photo(
                        chat_id=query.message.chat_id,
                        photo=image
                    )
            else:
                logger.error(f"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: {image_path}")
                await query.message.reply_text("–ò–∑–≤–∏–Ω–∏—Ç–µ, —á–∞—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —É—Ä–æ–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ üöß")
                break

        audio_path = os.path.join(AUDIO_FOLDER, f"lesson{lesson_num}_audio.ogg")
        if os.path.exists(audio_path):
            with open(audio_path, "rb") as audio:
                await context.bot.send_voice(
                    chat_id=query.message.chat_id,
                    voice=audio
                )
        else:
            logger.error(f"–ê—É–¥–∏–æ—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {audio_path}")
            await query.message.reply_text("–ê—É–¥–∏–æ –¥–ª—è —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ üöß")

        await query.message.reply_text(f"üìñ {lesson_topic}")

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥—Ä—É–ø–ø—É —É—Ä–æ–∫–æ–≤ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
        lesson_num_int = int(lesson_num)
        if lesson_num_int <= 10:
            back_to = "lessons_1_10"
        elif lesson_num_int <= 20:
            back_to = "lessons_11_20"
        elif lesson_num_int <= 30:
            back_to = "lessons_21_30"
        elif lesson_num_int <= 40:
            back_to = "lessons_31_40"
        elif lesson_num_int <= 50:
            back_to = "lessons_41_50"
        elif lesson_num_int <= 60:
            back_to = "lessons_51_60"
        elif lesson_num_int <= 70:
            back_to = "lessons_61_70"

        # –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
        next_lesson_num = lesson_num_int + 1
        keyboard = []
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫" —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if next_lesson_num <= max(LESSON_TOPICS.keys()):
            keyboard.append([
                InlineKeyboardButton(
                    "–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫",
                    callback_data=f"lesson_{next_lesson_num}"
                )
            ])
        
        # –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –∫ –≥—Ä—É–ø–ø–µ —É—Ä–æ–∫–æ–≤
        keyboard.append([
            InlineKeyboardButton(
                "–ù–∞–∑–∞–¥ –∫ —É—Ä–æ–∫–∞–º",
                callback_data=back_to
            )
        ])
        
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.message.reply_text(
            "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
            reply_markup=reply_markup
        )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —É—Ä–æ–∫–∞ {lesson_num}: {e}")
        await query.message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —É—Ä–æ–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–¥–µ–ª–∞ –∫–≤–∏–∑–∞
async def handle_quiz_choice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == "quiz_animals":
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞ "–ñ–∏–≤–æ—Ç–Ω—ã–µ"
        keyboard = [
            [InlineKeyboardButton("–î–∏–∫–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ", callback_data="quiz_wild_animals")],
            [InlineKeyboardButton("–î–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ", callback_data="quiz_domestic_animals")],
            [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="back_to_quizzes")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª:", reply_markup=reply_markup)
    elif query.data == "quiz_plants":
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞ "–ñ–∏–≤–∞—è –ø—Ä–∏—Ä–æ–¥–∞"
        keyboard = [
            [InlineKeyboardButton("–ü–∏—â–µ–≤—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è", callback_data="quiz_food_plants")],
            [InlineKeyboardButton("–õ–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è", callback_data="quiz_medicinal_plants")],
            [InlineKeyboardButton("–î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è", callback_data="quiz_decorative_plants")],
            [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="back_to_quizzes")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª:", reply_markup=reply_markup)


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞ "–ñ–∏–≤–æ—Ç–Ω—ã–µ"
async def handle_animals_subchoice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == "back_to_animal_types":  # –û–±—Ä–∞–±–æ—Ç–∫–∞ "–ù–∞–∑–∞–¥" –≤ –º–µ–Ω—é –ø–æ–¥—Ä–∞–∑–¥–µ–ª–æ–≤
        keyboard = [
            [InlineKeyboardButton("–î–∏–∫–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ", callback_data="quiz_wild_animals")],
            [InlineKeyboardButton("–î–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ", callback_data="quiz_domestic_animals")],
            [InlineKeyboardButton("‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–∞–∑–¥–µ–ª–∞–º", callback_data="back_to_quizzes")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª:", reply_markup=reply_markup)
        return

    if query.data == "quiz_wild_animals":
        context.user_data["current_quiz"] = random.sample(list(quiz_data_wild_animals.items()), 5)
        context.user_data["images_folder"] = IMAGES_FOLDER_WILD_ANIMALS
    elif query.data == "quiz_domestic_animals":
        context.user_data["current_quiz"] = random.sample(list(quiz_data_domestic_animals.items()), 5)
        context.user_data["images_folder"] = IMAGES_FOLDER_DOMESTIC_ANIMALS

    context.user_data["user_score"] = 0
    context.user_data["current_question_index"] = 0

    # –£–ë–ò–†–ê–ï–ú –ö–ù–û–ü–ö–£ "–ù–ê–ó–ê–î" –ü–†–ò –°–¢–ê–†–¢–ï –ö–í–ò–ó–ê
    await query.edit_message_text("–ü–æ–ª–µ—Ç–µ–ª–∏!")  # –ü—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç, –±–µ–∑ –∫–Ω–æ–ø–∫–∏
    await send_question(update, context)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞ "–ñ–∏–≤–∞—è –ø—Ä–∏—Ä–æ–¥–∞"
async def handle_plants_subchoice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == "back_to_plant_types":  # –û–±—Ä–∞–±–æ—Ç–∫–∞ "–ù–∞–∑–∞–¥" –≤ –º–µ–Ω—é –ø–æ–¥—Ä–∞–∑–¥–µ–ª–æ–≤
        keyboard = [
            [InlineKeyboardButton("–ü–∏—â–µ–≤—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è", callback_data="quiz_food_plants")],
            [InlineKeyboardButton("–õ–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è", callback_data="quiz_medicinal_plants")],
            [InlineKeyboardButton("–î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è", callback_data="quiz_decorative_plants")],
            [InlineKeyboardButton("‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–∞–∑–¥–µ–ª–∞–º", callback_data="back_to_quizzes")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª:", reply_markup=reply_markup)
        return

    if query.data == "quiz_food_plants":
        context.user_data["current_quiz"] = random.sample(list(quiz_data_food_plants.items()), 5)
        context.user_data["images_folder"] = IMAGES_FOLDER_FOOD_PLANTS
    elif query.data == "quiz_medicinal_plants":
        context.user_data["current_quiz"] = random.sample(list(quiz_data_medicinal_plants.items()), 5)
        context.user_data["images_folder"] = IMAGES_FOLDER_MEDICINAL_PLANTS
    elif query.data == "quiz_decorative_plants":
        context.user_data["current_quiz"] = random.sample(list(quiz_data_decorative_plants.items()), 5)
        context.user_data["images_folder"] = IMAGES_FOLDER_DECORATIVE_PLANTS

    context.user_data["user_score"] = 0
    context.user_data["current_question_index"] = 0

    # –£–ë–ò–†–ê–ï–ú –ö–ù–û–ü–ö–£ "–ù–ê–ó–ê–î" –ü–†–ò –°–¢–ê–†–¢–ï –ö–í–ò–ó–ê
    await query.edit_message_text("–ü–æ–ª–µ—Ç–µ–ª–∏!")  # –ü—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç, –±–µ–∑ –∫–Ω–æ–ø–∫–∏
    await send_question(update, context)




# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
async def handle_back(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == "back_to_start":
        # Go back to the main menu
        keyboard = [
            [InlineKeyboardButton("–ö–≤–∏–∑—ã", callback_data="quizzes")],
            [InlineKeyboardButton("–£—Ä–æ–∫–∏", callback_data="lessons")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", reply_markup=reply_markup)

    elif query.data == "back_to_quizzes":
        # Return to quiz section
        keyboard = [
            [InlineKeyboardButton("–ñ–∏–≤–æ—Ç–Ω—ã–µ", callback_data="quiz_animals")],
            [InlineKeyboardButton("–ü—Ä–∏—Ä–æ–¥–∞", callback_data="quiz_plants")],
            [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="back_to_start")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª –∫–≤–∏–∑–∞:", reply_markup=reply_markup)

    elif query.data == "lessons":
        # Return to the lessons menu
        keyboard = [
            [InlineKeyboardButton("1-10 –£—Ä–æ–∫–∏", callback_data="lessons_1_10")],
        [InlineKeyboardButton("11-20 –£—Ä–æ–∫–∏", callback_data="lessons_11_20")],
        [InlineKeyboardButton("21-30 –£—Ä–æ–∫–∏", callback_data="lessons_21_30")],
        [InlineKeyboardButton("31-40 –£—Ä–æ–∫–∏", callback_data="lessons_31_40")],
        [InlineKeyboardButton("41-50 –£—Ä–æ–∫–∏", callback_data="lessons_41_50")],
        [InlineKeyboardButton("51-60 –£—Ä–æ–∫–∏", callback_data="lessons_51_60")],
        [InlineKeyboardButton("61-70 –£—Ä–æ–∫–∏", callback_data="lessons_61_70")],
        [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="back_to_start")] 
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ –≥—Ä—É–ø–ø—É —É—Ä–æ–∫–æ–≤:", reply_markup=reply_markup)

async def handle_back(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    if query.data == "back_to_start":
        # –í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        keyboard = [
            [InlineKeyboardButton("–ö–≤–∏–∑—ã", callback_data="quizzes")],
            [InlineKeyboardButton("–£—Ä–æ–∫–∏", callback_data="lessons")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", reply_markup=reply_markup)
        
    elif query.data == "lessons":
        # –í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É –≥—Ä—É–ø–ø—ã —É—Ä–æ–∫–æ–≤
        keyboard = [
           [InlineKeyboardButton("1-10 –£—Ä–æ–∫–∏", callback_data="lessons_1_10")],
        [InlineKeyboardButton("11-20 –£—Ä–æ–∫–∏", callback_data="lessons_11_20")],
        [InlineKeyboardButton("21-30 –£—Ä–æ–∫–∏", callback_data="lessons_21_30")],
        [InlineKeyboardButton("31-40 –£—Ä–æ–∫–∏", callback_data="lessons_31_40")],
        [InlineKeyboardButton("41-50 –£—Ä–æ–∫–∏", callback_data="lessons_41_50")],
        [InlineKeyboardButton("51-60 –£—Ä–æ–∫–∏", callback_data="lessons_51_60")],
        [InlineKeyboardButton("61-70 –£—Ä–æ–∫–∏", callback_data="lessons_61_70")],
        [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="back_to_start")] 
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ –≥—Ä—É–ø–ø—É —É—Ä–æ–∫–æ–≤:", reply_markup=reply_markup)

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
async def send_question(update: Update, context: ContextTypes.DEFAULT_TYPE):
    current_quiz = context.user_data.get("current_quiz", [])
    current_question_index = context.user_data.get("current_question_index", 0)
    
    if current_question_index >= len(current_quiz):
        await end_quiz(update, context)
        return

    image_file, correct_answer = current_quiz[current_question_index]
    context.user_data["correct_answer"] = correct_answer  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
    
    image_path = os.path.join(context.user_data["images_folder"], image_file)
    
    try:
        with open(image_path, "rb") as image:
            keyboard = create_word_keyboard(correct_answer)
            # –ï—Å–ª–∏ —ç—Ç–æ –æ—Ç–≤–µ—Ç –Ω–∞ callback query (–ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏)
            if update.callback_query:
                await update.callback_query.message.reply_photo(
                    photo=image,
                    caption="–ú”ó–Ω–ª–µ —á”ó—Ä—á—É–Ω –∫—É?",
                    reply_markup=keyboard
                )
            else:  # –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
                await update.message.reply_photo(
                    photo=image,
                    caption="–ú”ó–Ω–ª–µ —á”ó—Ä—á—É–Ω –∫—É?",
                    reply_markup=keyboard
                )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤–æ–ø—Ä–æ—Å–∞: {e}")
        await update.effective_message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    user_answer = query.data
    correct_answer = context.user_data.get("correct_answer", "")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
    if user_answer == correct_answer:
        context.user_data["user_score"] += 1
        result_text = "–ú–∞—Ç—Ç—É—Ä! –¢”ó—Ä”ó—Å! üéâ"
    else:
        result_text = f"–¢”ó—Ä”ó—Å –º–∞—Ä. –¢”ó—Ä”ó—Å –æ—Ç–≤–µ—Ç: {correct_answer}."

    # –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    try:
        await query.edit_message_caption(
            caption=f"{query.message.caption}\n\n–í—ã –≤—ã–±—Ä–∞–ª–∏: {user_answer}\n{result_text}",
            reply_markup=None
        )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")

    # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
    context.user_data["current_question_index"] += 1
    await send_question(update, context)

# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–≤–∏–∑–∞
async def end_quiz(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_score = context.user_data.get("user_score", 0)
    await update.effective_message.reply_text(f"–ö–≤–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω! –¢—ã –Ω–∞–±—Ä–∞–ª {user_score} –±–∞–ª–ª–æ–≤ –∏–∑ 5.")

    # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    if user_score == 5:
        await update.effective_message.reply_text("–ú–æ–ª–æ–¥–µ—Ü! –£ —Ç–µ–±—è –≤—Å—ë —Ö–æ—Ä–æ—à–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è! üéâ")
    else:
        await update.effective_message.reply_text("–ù–µ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞? –ù–∞–∂–º–∏—Ç–µ /start.")

    # –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
    context.user_data.clear()

def main():
    application = Application.builder().token(TOKEN).build()

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
    application.add_handler(CommandHandler("start", start))

    # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    application.add_handler(CallbackQueryHandler(handle_menu_choice, pattern="^(quizzes|lessons)$"))

    # –†–∞–∑–¥–µ–ª—ã –∫–≤–∏–∑–æ–≤
    application.add_handler(CallbackQueryHandler(handle_quiz_choice, pattern="^(quiz_animals|quiz_plants)$"))
    application.add_handler(CallbackQueryHandler(handle_animals_subchoice, pattern="^(quiz_wild_animals|quiz_domestic_animals)$"))
    application.add_handler(CallbackQueryHandler(handle_plants_subchoice, pattern="^(quiz_food_plants|quiz_medicinal_plants|quiz_decorative_plants)$"))

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É—Ä–æ–∫–æ–≤
    application.add_handler(CallbackQueryHandler(handle_lessons_group, pattern=r"^lessons_(\d+)_(\d+)$"))
    application.add_handler(CallbackQueryHandler(handle_lesson, pattern=r"^lesson_(\d+)$"))

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
    application.add_handler(CallbackQueryHandler(handle_back, pattern="^(back_to_start|back_to_quizzes|lessons)$"))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫ —Å –æ—Ç–≤–µ—Ç–∞–º–∏ –≤ –∫–≤–∏–∑–µ
    application.add_handler(CallbackQueryHandler(button_callback))

    application.run_polling()

if __name__ == "__main__":
    main()
    #cd "C:\Users\ega_c\OneDrive\–†–∞–±–æ—á–∏–π —Å—Ç–æ–ª\Bot"
    #python bot.py.ini
    #C:\Users\ega_c\OneDrive\–†–∞–±–æ—á–∏–π —Å—Ç–æ–ª\Bot
