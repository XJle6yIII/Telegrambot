from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes
import os
import random
import logging

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(format="%(asctime)s - %(name)s - %(levelname)s - %(message)s", level=logging.INFO)
logger = logging.getLogger(__name__)

# –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
TOKEN = "7962193493:AAHpofB5A7Wqdm1WITbMpMzTSyUmUXZ_MwM"

# –ü—É—Ç–∏ –∫ –ø–∞–ø–∫–∞–º —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
IMAGES_FOLDER_WILD_ANIMALS = "./Images/Animals/Wild"
IMAGES_FOLDER_DOMESTIC_ANIMALS = "./Images/Animals/domestic"
IMAGES_FOLDER_FOOD_PLANTS = "./Images/Nature/Foodplants"
IMAGES_FOLDER_MEDICINAL_PLANTS = "./Images/Nature/Medicinalplants"
IMAGES_FOLDER_DECORATIVE_PLANTS = "./Images/\Nature/Ornamentalplants"

# –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫–≤–∏–∑–∞: –∫–∞—Ä—Ç–∏–Ω–∫–∞ -> –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
quiz_data_wild_animals = {
    "image1.jpg": "–ú—É–ª–∫–∞—á",
    "image2.jpg": "–ö–∞—à–∫”ë—Ä",
    "image3.jpg": "–£–ø–∞",
    "image4.jpg": "–¢–∏–ª”ó",
    "image5.jpg": "–ü–∞–ª–∞–Ω",
    "image6.jpg": "–ü—É—Ä”ë—à",
    "image7.jpg": "–•–∏—Ä –∫—É—à–∞–∫ƒï",
    "image8.jpg": "–•ƒÉ–Ω—ÇƒÉ—Ä",
    "image9.jpg": "–•–∏—Ä —Å—ã—Å–Ω–∏",
    "image10.jpg": "–Æ—Å",
    "image11.jpg": "–®—É—Ä”ë —É–ø–∞",
    "image12.jpg": "–í”ë–ª—Ç–∞ —Ç”ë–ø—Ä–∏",
    "image13.jpg": "–®–∞—à–∫–∞",
    "image14.jpg": "–ß–∞–ªƒÉ—à —Å—É—Ö–∞",
    "image15.jpg": "–•–∏—Ä –∫—É—à–∞–∫ƒï",
}

quiz_data_domestic_animals = {
    "image1.jpg": "–ô—ã—Ç”ë",
    "image2.jpg": "–ö—É—à–∞–∫",
    "image3.jpg": "”ñ–Ω–µ",
    "image4.jpg": "–õ–∞—à–∞",
    "image5.jpg": "–ö–∞—á–∞–∫–∞",
    "image6.jpg": "–°—É—Ä”ë—Ö",
    "image7.jpg": "–°—ã—Å–Ω–∞",
    "image8.jpg": "–ö—Ä–æ–ª–∏–∫",
    "image9.jpg": "–ß”ë—Ö",
    "image10.jpg": "–ö”ë–≤–∞–∫–∞–ª",
    "image11.jpg": "–•—É—Ä",
    "image12.jpg": "–öƒÉ—Ä–∫–∫–∞",
    "image13.jpg": "–ê—Ä–ª–∞–Ω",
    "image14.jpg": "–¢–∏–Ω”ó—Å —Å—ã—Å–Ω–∏",
    "image15.jpg": "–ü–æ–ø—É–≥–∞–π",
}

quiz_data_medicinal_plants = {
    "Image1.jpg": "–•—É—Ä”ë–Ω",
    "Image2.jpg": "–ö–∞—Ç”ë—Ä–∫–∞—Å",
    "Image3.jpg": "–ö”ó—Ç–º–µ–ª",
    "Image4.jpg": "–í”ó–ª—Ç—Ä–µ–Ω",
    "Image5.jpg": "–ö—É–∫—à–∞–ø—É“´",
}

quiz_data_food_plants = {
    "Image1.jpg": "“™”ó—Ä—É–ª–º–∏",
    "Image2.jpg": "–•”ó—Ä–ª”ó —Ö—É—Ä–ª”ë—Ö–∞–Ω",
    "Image3.jpg": "–•—É—Ä–∞ “´—ã—Ä–ª–∞",
    "Image4.jpg": "–•—É—Ä–∞ —Ö—É—Ä–ª”ë—Ö–∞–Ω",
    "Image5.jpg": "–£–ª–º—É“´“´–∏",
}

quiz_data_decorative_plants = {
    "Image1.jpg": "–†–æ–∑–∞",
    "Image2.jpg": "–¢—é–ª—å–ø–∞–Ω",
    "Image3.jpg": "–ì–≤–æ–∑–¥–∏–∫–∞",
    "Image4.jpg": "–•—Ä–∏–∑–∞–Ω—Ç–µ–º–∞",
    "Image5.jpg": "–û—Ä—Ö–∏–¥–µ—è",
}

# –°–ø–∏—Å–æ–∫ —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–ª–æ–≤ –¥–ª—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
random_words = [
    "–®–∫—É–ª", "–ö–∞–π”ë–∫", "–ô—ã–≤”ë“´", "–ö”ó–ª–µ–Ω—á–µ", "–ß”≥—Ä–µ—á–µ", "–´–ª—Ç”ë–Ω", "–ê–ª”ë–∫", "–¢—É—Ä–∞—Ç", "–ü–∞—Ç–∞–∫", "–ü—É–∫–∞–Ω", "–°”ó—Ç–µ–ª", "–°–∞–≤”ë—Ç-—Å–∞–ø–∞", "–ö”ó–Ω–µ–∫–µ", "–ö”ë—Ä–∞–Ω—Ç–∞—à", "–®”ë–ø—á”ë–∫", "–°—ã–≤–ª”ë—à", "–®”ë—Ä—á”ë–∫", "“™–∞–Ω—Ç–∞–ª”ë–∫", "“™—É–ª—Ç–∞–ª”ë–∫", "–ü”≥—Ä–Ω–µ",
    "–ú”ë–π”ë—Ä", "–ß”ó—Ä–µ", "–•”ó–≤–µ–ª", "–£–π”ë—Ö", "“™”ë–ª—Ç”ë—Ä", "–Æ—Ä", "“™—É–Ω–∞—à–∫–∞", "–ô”ó–ª—Ç”ó—Ä", "–ü—É“´", "–•”ë—è—Ä", "–®”ë–Ω–∞", "–Ø—à–∫–∞", "–®—ã–≤", "–í—É—Ç”ë", "”≤–∫–µ—Ä—á”ó–∫", "–•—É–ª–∞"
]

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ª–æ–≤
def create_word_keyboard(correct_answer):
    # –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ quiz_data (–∏—Å–∫–ª—é—á–∞—è —Ç–µ–∫—É—â–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
    all_quiz_answers = [v for k, v in quiz_data_wild_animals.items() if v != correct_answer] + \
                       [v for k, v in quiz_data_domestic_animals.items() if v != correct_answer] + \
                       [v for k, v in quiz_data_food_plants.items() if v != correct_answer] + \
                       [v for k, v in quiz_data_medicinal_plants.items() if v != correct_answer] + \
                       [v for k, v in quiz_data_decorative_plants.items() if v != correct_answer]
    
    # –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–ª–æ–≤
    all_random_words = random_words.copy()
    
    # –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ–±–∞ —Å–ø–∏—Å–∫–∞
    all_possible_wrong_answers = all_quiz_answers + all_random_words
    
    # –í—ã–±–∏—Ä–∞–µ–º 3 —Å–ª—É—á–∞–π–Ω—ã—Ö –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞
    wrong_answers = random.sample(all_possible_wrong_answers, 3)
    
    # –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–∑ 4 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: 1 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ 3 –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö
    options = [correct_answer] + wrong_answers
    random.shuffle(options)  # –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã

    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    keyboard = [[InlineKeyboardButton(word, callback_data=word)] for word in options]
    return InlineKeyboardMarkup(keyboard)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É –∫–≤–∏–∑–∞–º–∏ –∏ —É—Ä–æ–∫–∞–º–∏
    keyboard = [
        [InlineKeyboardButton("–ö–≤–∏–∑—ã", callback_data="quizzes")],
        [InlineKeyboardButton("–£—Ä–æ–∫–∏", callback_data="lessons")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text("–ü—Ä–∏–≤–µ—Ç! –í—ã–±–µ—Ä–∏, —á—Ç–æ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å:", reply_markup=reply_markup)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É –∫–≤–∏–∑–∞–º–∏ –∏ —É—Ä–æ–∫–∞–º–∏
async def handle_menu_choice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == "quizzes":
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–¥–µ–ª–∞ –∫–≤–∏–∑–∞
        keyboard = [
            [InlineKeyboardButton("–ñ–∏–≤–æ—Ç–Ω—ã–µ", callback_data="quiz_animals")],
            [InlineKeyboardButton("–ü—Ä–∏—Ä–æ–¥–∞", callback_data="quiz_plants")],
            [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="back_to_start")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª –∫–≤–∏–∑–∞:", reply_markup=reply_markup)
    elif query.data == "lessons":
        await query.edit_message_text("–£—Ä–æ–∫–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏!")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–¥–µ–ª–∞ –∫–≤–∏–∑–∞
async def handle_quiz_choice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == "quiz_animals":
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞ "–ñ–∏–≤–æ—Ç–Ω—ã–µ"
        keyboard = [
            [InlineKeyboardButton("–î–∏–∫–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ", callback_data="quiz_wild_animals")],
            [InlineKeyboardButton("–î–æ–º–∞—à–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ", callback_data="quiz_domestic_animals")],
            [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="back_to_quizzes")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª:", reply_markup=reply_markup)
    elif query.data == "quiz_plants":
        # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞ "–ñ–∏–≤–∞—è –ø—Ä–∏—Ä–æ–¥–∞"
        keyboard = [
            [InlineKeyboardButton("–ü–∏—â–µ–≤—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è", callback_data="quiz_food_plants")],
            [InlineKeyboardButton("–õ–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è", callback_data="quiz_medicinal_plants")],
            [InlineKeyboardButton("–î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è", callback_data="quiz_decorative_plants")],
            [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="back_to_quizzes")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª:", reply_markup=reply_markup)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞ "–ñ–∏–≤–æ—Ç–Ω—ã–µ"
async def handle_animals_subchoice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == "quiz_wild_animals":
        context.user_data["current_quiz"] = random.sample(list(quiz_data_wild_animals.items()), 5)
        context.user_data["images_folder"] = IMAGES_FOLDER_WILD_ANIMALS  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ
    elif query.data == "quiz_domestic_animals":
        context.user_data["current_quiz"] = random.sample(list(quiz_data_domestic_animals.items()), 5)
        context.user_data["images_folder"] = IMAGES_FOLDER_DOMESTIC_ANIMALS  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ

    context.user_data["user_score"] = 0
    context.user_data["current_question_index"] = 0

    await query.edit_message_text("–ü–æ–ª–µ—Ç–µ–ª–∏!")
    await send_question(update, context)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞ "–ñ–∏–≤–∞—è –ø—Ä–∏—Ä–æ–¥–∞"
async def handle_plants_subchoice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == "quiz_food_plants":
        context.user_data["current_quiz"] = random.sample(list(quiz_data_food_plants.items()), 5)
        context.user_data["images_folder"] = IMAGES_FOLDER_FOOD_PLANTS  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ
    elif query.data == "quiz_medicinal_plants":
        context.user_data["current_quiz"] = random.sample(list(quiz_data_medicinal_plants.items()), 5)
        context.user_data["images_folder"] = IMAGES_FOLDER_MEDICINAL_PLANTS  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ
    elif query.data == "quiz_decorative_plants":
        context.user_data["current_quiz"] = random.sample(list(quiz_data_decorative_plants.items()), 5)
        context.user_data["images_folder"] = IMAGES_FOLDER_DECORATIVE_PLANTS  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ

    context.user_data["user_score"] = 0
    context.user_data["current_question_index"] = 0

    await query.edit_message_text("–ü–æ–ª–µ—Ç–µ–ª–∏!")
    await send_question(update, context)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
async def handle_back(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == "back_to_start":
        # –í–æ–∑–≤—Ä–∞—Ç –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é
        keyboard = [
            [InlineKeyboardButton("–ö–≤–∏–∑—ã", callback_data="quizzes")],
            [InlineKeyboardButton("–£—Ä–æ–∫–∏", callback_data="lessons")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–ü—Ä–∏–≤–µ—Ç! –í—ã–±–µ—Ä–∏, —á—Ç–æ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å:", reply_markup=reply_markup)
    elif query.data == "back_to_quizzes":
        # –í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É —Ä–∞–∑–¥–µ–ª–∞ –∫–≤–∏–∑–∞
        keyboard = [
            [InlineKeyboardButton("–ñ–∏–≤–æ—Ç–Ω—ã–µ", callback_data="quiz_animals")],
            [InlineKeyboardButton("–ü—Ä–∏—Ä–æ–¥–∞", callback_data="quiz_plants")],
            [InlineKeyboardButton("–ù–∞–∑–∞–¥", callback_data="back_to_start")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.edit_message_text("–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª –∫–≤–∏–∑–∞:", reply_markup=reply_markup)

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
async def send_question(update: Update, context: ContextTypes.DEFAULT_TYPE):
    current_quiz = context.user_data.get("current_quiz", [])
    current_question_index = context.user_data.get("current_question_index", 0)
    images_folder = context.user_data.get("images_folder")  # –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

    if current_question_index >= len(current_quiz):
        await end_quiz(update, context)
        return

    image_path, correct_answer = current_quiz[current_question_index]
    context.user_data["correct_answer"] = correct_answer.lower()

    full_path = os.path.join(images_folder, image_path)  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ
    logger.info(f"–ü—ã—Ç–∞—é—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª: {full_path}")  # –õ–æ–≥–∏—Ä—É–µ–º –ø—É—Ç—å

    try:
        with open(full_path, "rb") as image:
            keyboard = create_word_keyboard(correct_answer)
            await update.effective_message.reply_photo(
                photo=image,
                caption="–ú”ó–Ω–ª–µ —á”ó—Ä—á—É–Ω –∫—É?",
                reply_markup=keyboard
            )
    except FileNotFoundError:
        logger.error(f"–§–∞–π–ª {full_path} –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        await update.effective_message.reply_text("–û—à–∏–±–∫–∞: —Ñ–∞–π–ª —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω.")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∞–π–ª–∞: {e}")
        await update.effective_message.reply_text("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    user_answer = query.data.lower()
    correct_answer = context.user_data.get("correct_answer", "")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
    if user_answer == correct_answer:
        context.user_data["user_score"] += 1
        result_text = "–ú–∞—Ç—Ç—É—Ä! –¢”ó—Ä”ó—Å! üéâ"
    else:
        result_text = f"–¢”ó—Ä”ó—Å –º–∞—Ä. –¢”ó—Ä”ó—Å –æ—Ç–≤–µ—Ç: {correct_answer}."

    # –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π –∏ –∫–Ω–æ–ø–∫–∞–º–∏, –¥–æ–±–∞–≤–ª—è—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    await query.edit_message_caption(
        caption=f"–ú”ó–Ω–ª–µ —á”ó—Ä—á—É–Ω –∫—É?\n\n–í—ã –≤—ã–±—Ä–∞–ª–∏: {user_answer}\n{result_text}",
        reply_markup=None  # –£–±–∏—Ä–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞
    )

    # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
    context.user_data["current_question_index"] += 1
    await send_question(update, context)

# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–≤–∏–∑–∞
async def end_quiz(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_score = context.user_data.get("user_score", 0)
    await update.effective_message.reply_text(f"–ö–≤–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω! –¢—ã –Ω–∞–±—Ä–∞–ª {user_score} –±–∞–ª–ª–æ–≤ –∏–∑ 5.")

    # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    if user_score == 5:
        await update.effective_message.reply_text("–ú–æ–ª–æ–¥–µ—Ü! –£ —Ç–µ–±—è –≤—Å—ë —Ö–æ—Ä–æ—à–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è! üéâ")
    else:
        await update.effective_message.reply_text("–ù–µ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞? –ù–∞–∂–º–∏—Ç–µ /start.")

    # –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
    context.user_data.clear()

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
def main():
    application = Application.builder().token(TOKEN).build()
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CallbackQueryHandler(handle_menu_choice, pattern="^(quizzes|lessons)$"))
    application.add_handler(CallbackQueryHandler(handle_quiz_choice, pattern="^(quiz_animals|quiz_plants)$"))
    application.add_handler(CallbackQueryHandler(handle_animals_subchoice, pattern="^(quiz_wild_animals|quiz_domestic_animals)$"))
    application.add_handler(CallbackQueryHandler(handle_plants_subchoice, pattern="^(quiz_food_plants|quiz_medicinal_plants|quiz_decorative_plants)$"))
    application.add_handler(CallbackQueryHandler(handle_back, pattern="^(back_to_start|back_to_quizzes)$"))
    application.add_handler(CallbackQueryHandler(button_callback))
    application.run_polling()

if __name__ == "__main__":
    main()
    #cd "C:\Users\ega_c\OneDrive\–†–∞–±–æ—á–∏–π —Å—Ç–æ–ª\Bot"
    #python bot.py.ini
    #C:\Users\ega_c\OneDrive\–†–∞–±–æ—á–∏–π —Å—Ç–æ–ª\Bot
